#### [1114. æŒ‰åºæ‰“å°](https://leetcode-cn.com/problems/print-in-order/)

éš¾åº¦ï¼šeasy

### **æ€è·¯ï¼š**

â€‹		ç¬¬ä¸€é“å¤šçº¿ç¨‹é¢˜ç›®ï¼Œä»¥ä¸‹æœ‰å…­ç§æ–¹æ³•ï¼ˆC++ï¼‰æ¥è§£é¢˜ï¼Œåˆ†åˆ«æ¶‰åŠäº†C++11ä¸­æ‰€æœ‰çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ã€‚å› æ­¤ä¹Ÿæœ‰6éƒ¨åˆ†çš„æºç ã€‚

### **æºç 1ï¼ˆç®€å•mutexï¼‰ï¼š**

```
//æš´åŠ›çš„mutexç›´æ¥ä¸Šé”/è§£é”ğŸ”“
//è¿™ç§åœ¨ä¸åŒç¨‹åºæ®µåˆ†åˆ«ä¸Šé”/è§£é”çš„å†™æ³•æ˜¯ä¸å½“çš„ğŸ”“
class Foo {
public:
    Foo() {
        mutex1.lock();
        mutex2.lock();
    }

    void first(function<void()> printFirst) {
        
        // printFirst() outputs "first". Do not change or remove this line.
        printFirst();
        mutex1.unlock();
    }

    void second(function<void()> printSecond) {
        mutex1.lock();
        // printSecond() outputs "second". Do not change or remove this line.
        printSecond();
        mutex1.unlock();
        mutex2.unlock();
    }

    void third(function<void()> printThird) {
        mutex2.lock();
        // printThird() outputs "third". Do not change or remove this line.
        printThird();
        mutex2.unlock();
    }
private:
    std::mutex mutex1,mutex2;
};
```

### æºç 2ï¼ˆunique_lockå’Œlock_guardï¼‰ï¼š

```
//ä½¿ç”¨äº†ç»è¿‡å°è£…çš„unique_lockå’Œlock_guard
//ä¸è¿‡æ„Ÿè§‰ä¸åˆ°å’Œæºç 1æœ‰ä»€ä¹ˆæœ¬è´¨çš„åŒºåˆ«
class Foo {
public:
    Foo():ulk_1(mutex_1,try_to_lock),ulk_2(mutex_2,try_to_lock) {
        
    }

    void first(function<void()> printFirst) {
        printFirst();
        ulk_1.unlock();
    }

    void second(function<void()> printSecond) {
        lock_guard<mutex> lg(mutex_1);
        printSecond();
        ulk_2.unlock();
    }

    void third(function<void()> printThird) {
        lock_guard<mutex> lg(mutex_2);
        printThird();
    }

private:
    std::mutex mutex_1, mutex_2;
    std::unique_lock<mutex> ulk_1,ulk_2;
};
```

### æºç 3ï¼ˆconditional_variableï¼‰ï¼š

```
//ä½¿ç”¨äº†æ¡ä»¶å˜é‡çš„æ–¹æ³•ï¼Œé¦–å…ˆå®ä¾‹åŒ–unique_lock,ç„¶åæ¡ä»¶å˜é‡æœ‰æ¡ä»¶åœ°wait
//ç›´åˆ°æ¡ä»¶ç¬¦åˆï¼Œæ‰èƒ½è·å–mutex
class Foo {
public:
     Foo() {

    }

    void first(function<void()> printFirst) {
        // printFirst() outputs "first". Do not change or remove this line.
        printFirst();
        k = 1;
        this->cond_.notify_all();
    }

    void second(function<void()> printSecond) {
        std::unique_lock<std::mutex> ulk(this->mutex_);
        this->cond_.wait(ulk,[this](){return k == 1;});
        // printSecond() outputs "second". Do not change or remove this line.
        printSecond();
        k = 2;
        this->cond_.notify_one();
    }

    void third(function<void()> printThird) {
        std::unique_lock<std::mutex> ulk(this->mutex_);
        this->cond_.wait(ulk,[this](){return k == 2;});
        // printThird() outputs "third". Do not change or remove this line.
        printThird();
    }
private:
    std::mutex mutex_;
    std::condition_variable cond_;
    int k = 0;
};
```

### æºç 4ï¼ˆsemaphoreï¼‰ï¼š

```
//ä¿¡å·é‡æœºåˆ¶ï¼Œç»å…¸
#include <semaphore.h>
class Foo {
public:
   Foo() {
        sem_init(&sem_1,0,0),sem_init(&sem_2,0,0);
    }

    void first(function<void()> printFirst) {
        // printFirst() outputs "first". Do not change or remove this line.
        printFirst();
        sem_post(&sem_1);
    }

    void second(function<void()> printSecond) {
        sem_wait(&sem_1);
        // printSecond() outputs "second". Do not change or remove this line.
        printSecond();
        sem_post(&sem_2);
    }

    void third(function<void()> printThird) {
        sem_wait(&sem_2);
        // printThird() outputs "third". Do not change or remove this line.
        printThird();
    }
private:
    sem_t  sem_1, sem_2;
};
```

### æºç 5ï¼ˆå¼‚æ­¥æœºåˆ¶ï¼‰ï¼š

```
//ä½¿ç”¨promiseæˆ–packaged_task, è¿ç”¨äº†futureçš„waitæ“ä½œ
class Foo {
public:
   Foo() {

    }

    void first(function<void()> printFirst) {
        // printFirst() outputs "first". Do not change or remove this line.
        printFirst();
        pro1.set_value();
    }

    void second(function<void()> printSecond) {
        pro1.get_future().wait();
        // printSecond() outputs "second". Do not change or remove this line.
        printSecond();
        pro2.set_value();
    }

    void third(function<void()> printThird) {
        pro2.get_future().wait();
        // printThird() outputs "third". Do not change or remove this line.
        printThird();
    }
private:
    std::promise <void> pro1, pro2;
};
```

### æºç 6ï¼ˆstd::atomicï¼‰ï¼š

```
//ç”¨åŸå­æ ‡å¿—ä½æ¥ç¡®ä¿å¼‚æ­¥ç¨‹åºçš„æ‰§è¡Œé¡ºåº
class Foo {
public:
    Foo() {

    }

    void first(function<void()> printFirst) {
        // printFirst() outputs "first". Do not change or remove this line.
        printFirst();
        a = true;
    }

    void second(function<void()> printSecond) {
        while (!a){
            this_thread::sleep_for(chrono::milliseconds(1));
        }
        // printSecond() outputs "second". Do not change or remove this line.
        printSecond();
        b = true;
    }

    void third(function<void()> printThird) {
        while (!b) {
            this_thread::sleep_for(chrono::milliseconds(1));
        }
        // printThird() outputs "third". Do not change or remove this line.
        printThird();
    }
private:
    std::atomic<bool> a{false},b{false};
    
};
```



### **ç”¨ä¾‹é€šè¿‡çŠ¶å†µï¼š**

**æ‰§è¡Œç”¨æ—¶ï¼š40 ms, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†82.90%çš„ç”¨æˆ·**

**å†…å­˜æ¶ˆè€—ï¼š15.8 MB, åœ¨æ‰€æœ‰ Python3 æäº¤ä¸­å‡»è´¥äº†24.82%çš„ç”¨æˆ·**

**é€šè¿‡æµ‹è¯•ç”¨ä¾‹ï¼š15 / 15**



@time ï¼š 2021/11/26  leetcodeæ—¥å¸¸åˆ·é¢˜â€”â€”â€œå¤šçº¿ç¨‹â€ç³»åˆ—  easy

